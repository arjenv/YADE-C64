<!DOCTYPE html>
<!-- 
  Arjen Vellekoop
  Index.html for C64 YADE
  July 2025
-->
<html>
	<head>
  		<title>C64 YADE July 2025</title>
  		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<meta charset="utf-8"/> <!-- shuts up warning -->
  		<link rel="icon" href="data:,">
  		<link rel="stylesheet" type="text/css" href="css/admin.css" />
	</head>    
	<body>
		<table>
			<tr>
				<td><h2>C64 YADE</h2></td><td></td><td><a href= "/settings"><button class="cssbutton">Settings</button></a></td>
			</tr>
			<tr>
				<td colspan="3"><p id="Notification" name="Notification" value="Notification" style.color='black'>Note</p></td>
			</tr>
			<tr>
				<td colspan="3">
					<form action="/playbutton"  method="get">
  						<label for="C64filename">File:</label>
	  					<input type="text" id="C64filename" name="C64filename" value="C64filename">
	  					<button type="button" id="Folder_icon" onclick="window.location.href='/files';"></button><br><br>

						<input type="radio" id="NormalSpeed" name="Uploadformat" value="0">
  						<label for="NormalSpeed" id="labelNormalSpeed">Normal speed</label><br>
						<input type="radio" id="TurboSpeed" name="Uploadformat" value="1">
  						<label for="Turbospeed" id="labelTurboSpeed">Turbo speed</label><br>
  						<input type="radio" id="AutoTurbo" name="Uploadformat" value="2">
  						<label for="AutoTurbo" id="labelAutoTurbo">Auto Fastload</label><br><br>
  						<input button type="button" name="play" id="Save_icon" onclick="Submitform('Save')" title="Record&Play">
  						<input button type="button" name="play" id="Play_icon" onclick="Submitform('PLAY')" title="Play">
  						<input button type="button" name="play" id="Panic_icon" onclick="Submitform('PANIC')" title="Panic"><br><br>
  					
  						<p id="RecordOptions" name="RecordOptions">Save options:</p>
						<input type="checkbox" id="RecordOverwrite" name="RecordOption" value="1">
  						<label for="RecordOverwrite" id="labelRecordOverwrite" title="Overwrite file">Overwrite</label><br>
  						<input type="checkbox" id="RecordClean" name="RecordOption" value="2">
  						<label for="RecordClean" id="labelRecordClean" title="Clean up TAP">Clean up TAP</label><br>
 						
					</form>
				</td>
			</tr>
			<tr>
				<td>
				</td></tr>
		</table>
	</body>
	<script>

	function Submitform(action) {
	
		var urltocall = "/playbutton?C64filename=" + document.getElementById("C64filename").value + "&Uploadformat=";
		var radiobtns = document.getElementsByName('Uploadformat');
		var upl=10;
		for(var i = 0; i < radiobtns.length; i++){
   		if(radiobtns[i].checked){
     			upl = radiobtns[i].value;
	   	}
		}
		urltocall += upl;
		urltocall += "&play=" + action;
		let RecordOption = 0; 	// RecordOption = 0: No action
										// RecordOption = 1: Overwrite File
										// RecordOption = 2: Clean up TAP
										// Recordoption = 3: Overwrite file AND cleanup TAP
										
		radiobtns = document.getElementsByName('RecordOption');
		for (i=0; i<radiobtns.length; i++){
			if(radiobtns[i].checked){
				RecordOption+= parseInt(radiobtns[i].value);
			}
		}
		urltocall += "&RecordOption=" + RecordOption;
		console.log(urltocall);
		document.getElementById("Notification").style.color ='black';
			
		xmlhttp=new XMLHttpRequest();
		xmlhttp.open("GET", urltocall, true);
		xmlhttp.send();
		if (action=='Save') document.getElementById("Notification").innerHTML = "Record&Play";
		if (action=='PLAY') document.getElementById("Notification").innerHTML = "Save";
		if (action=='PANIC') document.getElementById("Notification").innerHTML = "Panic...";
		xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				let resp=xmlhttp.responseText;
				document.getElementById("Notification").innerHTML = resp;
				if (resp.startsWith("!")) {
					document.getElementById("Notification").style.color ='#D60000';
				}
			}
		};
	}


	const getdata = async() => {
  		try {
    		const response = await fetch('/get_indexdata');
			// Check for 2xx status codes.
    		if (!response.ok) {
      		throw new Error('Error fetching data');
    		}

    		// Parse the JSON response.
    		const json_Indexdata = await response.json();
        			for (const Edata of json_Indexdata) {
						if (Edata.name == "C64filename") {
							var ext = Edata.value.substr(Edata.value.lastIndexOf('.') + 1).toUpperCase();
						}

        				if (Edata.name == "Uploadformat") {
							if (ext == "TAP") {
								document.getElementById("labelNormalSpeed").style.color = "grey";
								document.getElementById("NormalSpeed").disabled = true;
								document.getElementById("labelTurboSpeed").style.color = "grey";
								document.getElementById("TurboSpeed").disabled = true;
								document.getElementById("labelAutoTurbo").style.color = "grey";
								document.getElementById("AutoTurbo").disabled = true;
							}
							else {
        						switch(Edata.value) {
        							case 0:
        								document.getElementById("NormalSpeed").checked = true;
//										document.getElementById("labelNormalSpeed").style.color = "red";
	        							break;
    	    						case 1:
        								document.getElementById("TurboSpeed").checked = true;
//										document.getElementById("labelTurboSpeed").style.color = "red";
        								break;
        							case 2:
        								document.getElementById("AutoTurbo").checked = true;
//										document.getElementById("labelAutoTurbo").style.color = "red";
        								break;
        							default:
        								console.log("Error in Uploadformat");
        						}
							}
        				}

						const element = document.getElementById(Edata.name);
        				if (!element) continue;
        				element.value = Edata.value;
						element.innerHTML = Edata.value;						
        			}

    		// Fetch the data again after 21 seconds.
    		//setTimeout(getdata, 21000);
  		} 
  		catch (error) {
    		// TODO: Handle errors instead of logging them.
  			console.error(error);
  		}
	};
	getdata();
	
	</script>
</html>